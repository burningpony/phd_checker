        $(".participant").show();
        $(".essay").hide();
        $(".correction").hide();    
        setInterval( "updateStats()", 60000 );
        $(document).ready(function(){

        function generate_box(span) {
        span.className = "correctme unmodified";

        console.log(span);
        var original_text = $(span).html();

        //clear it
        $(span).html("");

        var input = document.createElement("input")
        input.type     = "text";
        input.value    = original_text;
        input.size     = input.value.length*1.2;

        var correct_answer = input.getAttribute('rel');

        input.state = function() {
        /*
        Given a span like:
        <span class='correctme' rel='correct string'>original string<\/span>

        Tells us whether the string modified by the user is
        - correct
        - modified, but reverted to the original
        - no change (un touched at all by the user)
        - modifies, and returns difference
        */
        var current_value = input.value;

        if(input.modified) {
        if(current_value == correct_answer) {
        return { status: "correct",  msg: correct_answer, style_class: "state_correct" }
        }
        else if(current_value == original_text) {
        return {status: "incorrect - reverted to original", msg: "modified but returned to normal", style_class: "state_reverted"}
        }
        else {
        // find the differnce between original and difference
        // using the diffString Algorithm
        var difference = diffString(original_text, current_value);

        // modified, return difference
        return {status: "incorrect - modified", msg: difference, style_class: "state_modified"} 
        }

        }else {
        return { status: "incorrect - no change", msg: current_value, style_class: "state_no_change"};
        }
        }

        var change_function = function() {

        // remember that the field was modified
        input.modified = true;

        // timeout 10ms so we can read the input value for changes
        setTimeout(function() {
        span.className = "correctme modified";

        if(input.value == original_text) {
        span.className = "correctme unmodified";

        }                        

        },10);
        }

        // handle change events
        input.onkeyup   = change_function;
        input.onchange  = change_function;


        span.appendChild(input);

        }

        $(".essay span.correctme").each(function(){
        generate_box(this);
        });

        $("span.correctme input").change(function() {
        var correct_me_id = $(this).closest("span").attr('id');
        var corrected = $(this).val()
        var uncorrected = $(this).closest("span").attr('rel');
        var essay = $(this).closest("div").attr("id");

        send_correction($(".participant #number").val(),essay,correct_me_id, uncorrected, corrected );
        });


        $(".participant .continue").click(function(){
        $(".essay").show();
        $(".participant").hide();
        $("#user h2 span").html( $(".participant #number").val());
        });

        $(".essay .continue").click(function(){
        $(".essay").hide();
        $(".correction").show();                


        // clear it
        $(".correction .result").html("");

        // show the fields entered
        var list =  document.createElement("ol");

        $(".essay span.correctme input").each(function(){

        // Creates a report of the differences and corrected items

        var list_item =  document.createElement("li");
        var result_string = "";
        var result = this.state();

        result_string = "<span class='status " + result.style_class + "'>" + result.status + "<\/span><span class='message'>" + result.msg + "<\/span>"; 

        $(list_item).html( result_string );
        list.appendChild(list_item);

        // You could imagine saving the results here
        });                

        $(".correction .result")[0].appendChild(list);
        });  


        $(".correction .continue").click(function(){

        $(".correction").hide();
        $(".participant").show();                
        });            

        });
        // sends it all to the back end.  user is create or found by participant, locations are set by the essay ID then the field ID ,  what the text was supposed to be what it was sent and if that is right. 
        function send_correction (participant, essay, id, uncorrected, corrected, correct, number_changed_in_quota ) {
        var params = { "participant_id":participant, "response":{"essay":essay,"id":id, "uncorrected":uncorrected , "corrected":corrected , "correct":correct } };
        var str = jQuery.param(params);

        $.ajax({
        type: 'POST',
        url: "responses",
        data: str
        });
        }

        function updateStats () {
          $.fancybox({
              "users/stats" : responseText
          });
        }
        </script> 
        <script type="text/javascript">